<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Two and three dimensional linear image registration — niftyreg.linear • RNiftyReg</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Two and three dimensional linear image registration — niftyreg.linear"><meta property="og:description" content="The niftyreg.linear function performs linear registration for two and
three dimensional images. 4D images may also be registered volumewise to a
3D image, or 3D images slicewise to a 2D image. Rigid-body (6 degrees of
freedom) and affine (12 degrees of freedom) registration can currently be
performed."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RNiftyReg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.8.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/jonclayden/RNiftyReg/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Two and three dimensional linear image registration</h1>
    <small class="dont-index">Source: <a href="https://github.com/jonclayden/RNiftyReg/blob/2.8.4.s/R/niftyreg.R" class="external-link"><code>R/niftyreg.R</code></a></small>
    <div class="hidden name"><code>niftyreg.linear.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The <code>niftyreg.linear</code> function performs linear registration for two and
three dimensional images. 4D images may also be registered volumewise to a
3D image, or 3D images slicewise to a 2D image. Rigid-body (6 degrees of
freedom) and affine (12 degrees of freedom) registration can currently be
performed.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">niftyreg.linear</span><span class="op">(</span><span class="va">source</span>, <span class="va">target</span>, scope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"affine"</span>, <span class="st">"rigid"</span><span class="op">)</span>, init <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sourceMask <span class="op">=</span> <span class="cn">NULL</span>, targetMask <span class="op">=</span> <span class="cn">NULL</span>, symmetric <span class="op">=</span> <span class="cn">TRUE</span>, nLevels <span class="op">=</span> <span class="fl">3L</span>,</span>
<span>  maxIterations <span class="op">=</span> <span class="fl">5L</span>, useBlockPercentage <span class="op">=</span> <span class="fl">50L</span>, interpolation <span class="op">=</span> <span class="fl">3L</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>, estimateOnly <span class="op">=</span> <span class="cn">FALSE</span>, sequentialInit <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  internal <span class="op">=</span> <span class="cn">NA</span>, precision <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"double"</span>, <span class="st">"single"</span><span class="op">)</span>,</span>
<span>  threads <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"RNiftyReg.threads"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-source">source<a class="anchor" aria-label="anchor" href="#arg-source"></a></dt>
<dd><p>The source image, an object of class <code>"nifti"</code> or
<code>"internalImage"</code>, or a plain array, or a NIfTI-1 filename. Must have
2, 3 or 4 dimensions.</p></dd>


<dt id="arg-target">target<a class="anchor" aria-label="anchor" href="#arg-target"></a></dt>
<dd><p>The target image, an object of class <code>"nifti"</code> or
<code>"internalImage"</code>, or a plain array, or a NIfTI-1 filename. Must have
2 or 3 dimensions.</p></dd>


<dt id="arg-scope">scope<a class="anchor" aria-label="anchor" href="#arg-scope"></a></dt>
<dd><p>A string describing the scope, or number of degrees of freedom
(DOF), of the registration. The currently supported values are
<code>"affine"</code> (12 DOF), <code>"rigid"</code> (6 DOF) or <code>"nonlinear"</code>
(high DOF, with the exact number depending on the image sizes).</p></dd>


<dt id="arg-init">init<a class="anchor" aria-label="anchor" href="#arg-init"></a></dt>
<dd><p>Transformation(s) to be used for initialisation, which may be
<code>NULL</code>, for no initialisation, or an affine matrix or control point
image (nonlinear only). For multiple registration, where the source image
has one more dimension than the target, this may also be a list whose
components are likewise <code>NULL</code> or a suitable initial transform.</p></dd>


<dt id="arg-sourcemask">sourceMask<a class="anchor" aria-label="anchor" href="#arg-sourcemask"></a></dt>
<dd><p>An optional mask image in source space, whose nonzero
region will be taken as the region of interest for the registration.
Ignored when <code>symmetric</code> is <code>FALSE</code>.</p></dd>


<dt id="arg-targetmask">targetMask<a class="anchor" aria-label="anchor" href="#arg-targetmask"></a></dt>
<dd><p>An optional mask image in target space, whose nonzero
region will be taken as the region of interest for the registration.</p></dd>


<dt id="arg-symmetric">symmetric<a class="anchor" aria-label="anchor" href="#arg-symmetric"></a></dt>
<dd><p>Logical value. Should forward and reverse transformations
be estimated simultaneously?</p></dd>


<dt id="arg-nlevels">nLevels<a class="anchor" aria-label="anchor" href="#arg-nlevels"></a></dt>
<dd><p>A single integer specifying the number of levels of the
algorithm that should be applied. If zero, no optimisation will be
performed, and the final affine matrix will be the same as its
initialisation value.</p></dd>


<dt id="arg-maxiterations">maxIterations<a class="anchor" aria-label="anchor" href="#arg-maxiterations"></a></dt>
<dd><p>A single integer specifying the maximum number of
iterations to be used within each level. Fewer iterations may be used if a
convergence test deems the process to have completed.</p></dd>


<dt id="arg-useblockpercentage">useBlockPercentage<a class="anchor" aria-label="anchor" href="#arg-useblockpercentage"></a></dt>
<dd><p>A single integer giving the percentage of blocks
to use for calculating correspondence at each step of the algorithm. The
blocks with the highest intensity variance will be chosen.</p></dd>


<dt id="arg-interpolation">interpolation<a class="anchor" aria-label="anchor" href="#arg-interpolation"></a></dt>
<dd><p>A single integer specifying the type of interpolation
to be applied to the final resampled image. May be 0 (nearest neighbour),
1 (trilinear) or 3 (cubic spline). No other values are valid.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>A single logical value: if <code>TRUE</code>, the code will give
some feedback on its progress; otherwise, nothing will be output while the
algorithm runs. Run time can be seconds or more, depending on the size and
dimensionality of the images.</p></dd>


<dt id="arg-estimateonly">estimateOnly<a class="anchor" aria-label="anchor" href="#arg-estimateonly"></a></dt>
<dd><p>Logical value: if <code>TRUE</code>, transformations will be
estimated, but images will not be resampled.</p></dd>


<dt id="arg-sequentialinit">sequentialInit<a class="anchor" aria-label="anchor" href="#arg-sequentialinit"></a></dt>
<dd><p>If <code>TRUE</code> and <code>source</code> has higher
dimensionality than <code>target</code>, transformations which are not
explicitly initialised will begin from the result of the previous
registration.</p></dd>


<dt id="arg-internal">internal<a class="anchor" aria-label="anchor" href="#arg-internal"></a></dt>
<dd><p>If <code>NA</code>, the default, the final resampled image will be
returned as a standard R array, but control point maps will be objects of
class <code>"internalImage"</code>, containing only basic metadata and a C-level
pointer to the full image. (See also <code><a href="readNifti.html">readNifti</a></code>.) If
<code>TRUE</code>, all image-type objects in the result will be internal images;
if <code>FALSE</code>, they will all be R arrays. The default is fine for most
purposes, but using <code>TRUE</code> may save memory, while using <code>FALSE</code>
can be necessary if there is a chance that external pointers will be
invalidated, for example when returning from worker threads.</p></dd>


<dt id="arg-precision">precision<a class="anchor" aria-label="anchor" href="#arg-precision"></a></dt>
<dd><p>Working precision for the registration. Using single-
precision may be desirable to save memory when coregistering large images.</p></dd>


<dt id="arg-threads">threads<a class="anchor" aria-label="anchor" href="#arg-threads"></a></dt>
<dd><p>For OpenMP-capable builds of the package, the maximum number
of threads to use.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>See <code><a href="niftyreg.html">niftyreg</a></code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function performs the dual operations of finding a transformation to
optimise image alignment, and resampling the source image into the space of
the target image.</p>
<p>The algorithm is based on a block-matching approach and Least Trimmed
Squares (LTS) fitting. Firstly, the block matching provides a set of
corresponding points between a target and a source image. Secondly, using
this set of corresponding points, the best rigid or affine transformation is
evaluated. This two-step loop is repeated until convergence to the best
transformation is achieved.</p>
<p>In the NiftyReg implementation, normalised cross-correlation between the
target and source blocks is used to evaluate correspondence. The block width
is constant and has been set to 4 voxels. A coarse-to-fine approach is used,
where the registration is first performed on down-sampled images (using a
Gaussian filter to resample images), and finally performed on full
resolution images.</p>
<p>The source image may have 2, 3 or 4 dimensions, and the target 2 or 3. The
dimensionality of the target image determines whether 2D or 3D registration
is applied, and source images with one more dimension than the target (i.e.
4D to 3D, or 3D to 2D) will be registered volumewise or slicewise, as
appropriate. In the latter case the last dimension of the resulting image is
taken from the source image, while all other dimensions come from the
target. One affine matrix is returned for each registration performed.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>The algorithm used by this function is described in the
following publication.</p>
<p>M. Modat, D.M. Cash, P. Daga, G.P. Winston, J.S. Duncan &amp; S. Ourselin
(2014). Global image registration using a symmetric block-matching approach.
Journal of Medical Imaging 1(2):024003.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="niftyreg.html">niftyreg</a></code>, which can be used as an interface to this
  function, and <code><a href="niftyreg.nonlinear.html">niftyreg.nonlinear</a></code> for nonlinear registration.
  Also, <code><a href="forward.html">forward</a></code> and <code><a href="forward.html">reverse</a></code> to extract
  transformations, and <code><a href="applyTransform.html">applyTransform</a></code> to apply them to new
  images or points.</p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Jon Clayden &lt;code@clayden.org&gt;</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jon Clayden, Marc Modat, Benoit Presles, Thanasis Anthopoulos, Pankaj Daga.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

